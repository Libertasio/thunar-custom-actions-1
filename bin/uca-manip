#!/usr/bin/env python3
import argparse
import sys
import textwrap
import logging

# external modules
from lxml import etree

logging.basicConfig(level = logging.INFO)

# Options
parser = argparse.ArgumentParser( 
    description = textwrap.dedent("""
        Merge two or more Thunar custom action XML files.
        <actions> are seen as equal, if all content matches. The <unique-id> is
        ignored for this check.
        The first file will be used as the base.
        """)
    )
parser.add_argument("-o","--output", help = "output xml file", default = "-", 
    required = False)
parser.add_argument("files", help = "xml files to merge", nargs='+')
args = parser.parse_args()

for ucafile in args.files: # loop over all files
    if ucafile == "-":
        input_file = sys.stdin
    else:
        input_file = open(ucafile,"r")
    tree = etree.parse( input_file ) # read XML
    root = tree.getroot() # XML root
    try:
        out_xml
    except NameError:
        out_xml = tree


if args.output == "-":
    output_file = sys.stdout
else:
    output_file = open(args.output,"w")

# write XML
xml_string = etree.tostring( out_xml, pretty_print = True, encoding = str )
output_file.write( xml_string )

